//  Copyright Open Logistics Foundation
//
//  Licensed under the Open Logistics Foundation License 1.3.
//  For details on the licensing terms, see the LICENSE file.
//  SPDX-License-Identifier: OLFL-1.3
//

#ifndef VDA5050_2B_2B_CORE_EVENTS_ORDER_EVENT_H_
#define VDA5050_2B_2B_CORE_EVENTS_ORDER_EVENT_H_

#include "vda5050++/events/event_type.h"
#include "vda5050++/misc/order_status.h"
#include "vda5050/ActionStatus.h"

namespace vda5050pp::core::events {

///
///\brief The identifier type for OrderEvents
///
enum class OrderEventType {
  k_action_status_changed,
  k_new_last_node_id,
  k_order_status,
  k_clear_after_cancel,
  k_clear_after_reset,
};

///
///\brief OrderEvents are generated by the order/scheduler module.
/// They can be received to get information about the order status and
/// set the vda5050::State accordingly.
///
struct OrderEvent : public vda5050pp::events::Event<OrderEventType> {};

///
///\brief This event is generated when the status of an action changed.
///
struct OrderActionStatusChanged
    : public vda5050pp::events::EventId<OrderEvent, OrderEventType::k_action_status_changed> {
  std::string action_id;
  ///\brief the status of the action
  vda5050::ActionStatus action_status;
  ///\brief a result string, that can be set if the action_status is FINISHED
  std::optional<std::string> result;
};

///
///\brief The order module yields this event, when the last node id of the AGV (in sync with the
/// order)
/// has changed.
///
struct OrderNewLastNodeId
    : public vda5050pp::events::EventId<OrderEvent, OrderEventType::k_new_last_node_id> {
  ///\brief the new last node id
  std::string last_node_id;
  ///\brief the sequence id of the last node
  decltype(vda5050::Node::sequenceId) seq_id;
};

///
///\brief The order module yields this event, when the status of the order changed.
///
struct OrderStatus : public vda5050pp::events::EventId<OrderEvent, OrderEventType::k_order_status> {
  ///\brief the status of the order
  vda5050pp::misc::OrderStatus status;
};

///
///\brief This event is generated when an order was canceled and the state shall be cleared
///
struct OrderClearAfterCancel
    : public vda5050pp::events::EventId<OrderEvent, OrderEventType::k_clear_after_cancel> {
  ///\brief the associated cancel instant action
  std::shared_ptr<const vda5050::Action> cancel_action;
};

///
///\brief This event is generated when an order was reset and the state shall be cleared
///
struct OrderClearAfterReset
    : public vda5050pp::events::EventId<OrderEvent, OrderEventType::k_clear_after_reset> {};

}  // namespace vda5050pp::core::events

#endif  // VDA5050_2B_2B_CORE_EVENTS_ORDER_EVENT_H_
